(function (name, context, definition) {
  if (typeof module !== "undefined" && module.exports) {
    module.exports = definition();
  } else if (typeof define == "function" && define.amd) {
    define(definition);
  } else {
    context[name] = definition();
  }
})("Primus", this, function PRIMUS() {
'use strict';

/**
 * Primus in a real-time library agnostic framework for establishing real-time
 * connections with servers.
 *
 * @param {String} url The url of your server.
 */
function Primus(url, options) {
  if (!(this instanceof Primus)) return new Primus(url);
  options = options || {};

  this.buffer = [];                       // Stores premature send data.
  this._events = {};                       // Stores the events.
  this.writable = true;                   // Silly stream compatiblity.
  this.readable = true;                   // Silly stream compatiblity.
  this.url = this.parse(url);             // Parse the url to a readable format.
  this.backoff = options.reconnect || {}; // Stores the backo